#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "üß™ Running environment check before push..."

# Default to production unless specified
ENV="${ENV:-production}"

# Run the check
# Check for --skip-check argument
SKIP_CHECK=false
SKIP_TEST=false
for arg in "$@"; do
  if [ "$arg" = "--skip-check" ]; then
    SKIP_CHECK=true
    break
  fi
  if [ "$arg" = "--skip-test" ]; then
    SKIP_TEST=true
    break
  fi
done

if [ "$SKIP_CHECK" = false ]; then
  node ./src/check-env.js $ENV
else
  echo "‚ö†Ô∏è  Skipping environment check as requested."
fi

if [ $? -ne 0 ]; then
  echo "‚ùå Env check failed. Push aborted."
  exit 1
fi

echo "‚úÖ Env check passed. Proceeding with push..."

if [ "$SKIP_TEST" = false ]; then
  npm test

else
  echo "‚ö†Ô∏è  Skipping tests as requested."
  exit 0
fi


if [ $? -ne 0 ]; then
  echo "‚ùå Unit Tests Failed. Push aborted."
  exit 1
fi

echo "‚úÖ Test Passed. Proceeding with push..."